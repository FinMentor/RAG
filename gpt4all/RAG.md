### RAG

### 사용하는 이유
- 더 정확하고 관련성 높은 정보를 제공
  - 할루시네이션 효과 없음
  - 도메인에 특화된 정확한 답변을 제공할 수 있음

### 목표
 - 뉴스 데이터를 토대로 일일 동향 리포트 생성

0. 사전조건
  - DB에 종목 데이터가 저장되어 있음
  - 네이버 검색 API 키가 있음

1. 데이터 수집
  - 네이버 뉴스 검색 API를 통해 뉴스 기사 수집
  - 각 종목에 대해 뉴스 기사 10개를 수집(최대 100개)
  - 뉴스 기사 제목, 내용, 링크, 대표 이미지 저장
  - chroma vector store 저장
    1. 뉴스 데이터를 Document 형식으로 저장
    2. OpenAI의 text-embedding-3-large를 통해 벡터화
    3. chroma vector store에 저장
    - 문제점 : chroma에 저장된 데이터 개수가 많으면 에러 발생
    - 해결 : chroma db 샤딩 ex) collection을 chroma_db_1, chroma_db_2 ... 로 생성
  - MySQL DB에 저장

2. 검색
  - 쿼리 입력 시 뉴스 데이터 중 가장 유사도가 높은 Document 10개 검색
  - 검색된 데이터를 토대로 답변 생성
  - 답변을 생성하지 못하는 경우 :
    1. +5개의 문서를 추가로 검색
    2. 40개까지 검색
    3. 샤딩된 다른 vector store에서 검색
    4. 인터넷 검색을 통해 답변을 생성
    
3. 답변 생성
  - 검색된 데이터를 토대로 답변 생성
  - OpenAI의 gpt-4o-mini를 통해 답변 생성

### 개선 방안
  - langgraph를 활용하여 failover 구현